import { json } from "@sveltejs/kit"
import Ajv, { type JSONSchemaType } from "ajv";
import jwt from "jsonwebtoken"

const ajv = new Ajv()

interface Data {
  password: string;
  handle: string;
  code: string;
}

const schema: JSONSchemaType<Data> = {
  type: 'object',
  properties: {
    password: { type: 'string' },
    handle: { type: 'string' },
    code: { type: 'string' }
  },
  required: ['handle', 'code', 'password'],
  additionalProperties: false
};

const validate = ajv.compile(schema)

export async function POST(params: any) {
    const data = await params.request.json()
    if (validate(data)) {
        return await json(validate.errors)
    }
    return await json("OK")
}